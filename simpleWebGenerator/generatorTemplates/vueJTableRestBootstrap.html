<script type="text/html" id="user_tmpl">
<!--    <button type="button" class="copy btn btn-success">1</button>
    <button type="button" class="copy btn btn-success">2</button>-->
    <pre>
        <code lang="html">
            <ol>
                <li><!-- template.html --></li>
                <li>&lt;meta http-equiv=&quot;content-type&quot; content=&quot;text/html; charset=UTF-8&quot;&gt;                                               </li>
                <li>    &lt;meta charset=&quot;utf-8&quot;&gt;                                                                                                  </li>
                <li>    &lt;meta http-equiv=&quot;X-UA-Compatible&quot; content=&quot;IE=edge&quot;&gt;                                                         </li>
                <li>    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1&quot;&gt;                                          </li>
                <li>    &lt;meta name=&quot;description&quot; content=&quot;&quot;&gt;                                                                          </li>
                <li>    &lt;meta name=&quot;author&quot; content=&quot;&quot;&gt;                                                                               </li>
                <li>    &lt;link href=&quot;js/jtable.2.4.0/themes/metro/green/jtable.min.css&quot; rel=&quot;stylesheet&quot; type=&quot;text/css&quot; /&gt;  </li>
                <li>    &lt;script src=&quot;./js/jquery.js&quot;&gt;&lt;/script&gt;                                                                        </li>
                <li>    &lt;script src=&quot;./js/jquery-ui-1.11.0/jquery-ui.min.js&quot;&gt;&lt;/script&gt;                                                    </li>
                <li>    &lt;script src=&quot;js/jtable.2.4.0/jquery.jtable.js&quot;&gt;&lt;/script&gt;                                                          </li>
            </ol>
        </code>  
        <code lang="hljs javascript js">
            <ol
                <li>//--------------------------------------    t.js    -------------------</li>
                <li>var t={</li>
                <% for ( var i = 0; i < selectedTables.length; i++ ) { 
                    var schemaName=selectedTables[i].schema;              
                    var tableName=selectedTables[i].table;                
                    var funcName = generator.capitaliseFirstLetter(tableName); 
                    var tableTitle = "List_T_"+tableName.toUpperCase(); 

                    var actionName = tableName;             
                    var allAttribs =generator.getTableFieldNamesArr(schemaName,tableName,false); 
                    var attribsInPkey=generator.getPkeyFieldNames(schemaName,tableName); %>

                <li>     <%=tableName%>:{</li>
                <li>           title: L["<%=tableTitle%>"],</li>
                <li>           paging: true,</li>
                <li>           sorting: true,</li>
                <li>           defaultSorting: "<%=allAttribs[0]%> ASC",</li>
                <li>           openChildAsAccordion: true,   </li>
                <li>           actions: {           </li>
                <li>               listAction: "./index.php?a=<%=actionName%>_list",    </li>
                <li>               deleteAction: "./index.php?a=<%=actionName%>_delete",    </li>
                <li>               updateAction: "./index.php?a=<%=actionName%>_update",    </li>
                <li>               createAction: "./index.php?a=<%=actionName%>_insert"      </li>
                <li>           },                             </li>
                <li>           fields: {    </li>            
                    
                    <%
                        
                        for ( var j = 0; j < allAttribs.length; j++ ) { 
                            var fieldName = allAttribs[j]; 
                            var fieldDataType = generator.getFieldGenericDataType(schemaName,tableName,fieldName); 
                            var fieldId="f:"+tableName.toUpperCase()+"_"+fieldName.toUpperCase() ;
                            var isPartOfPkey =  $.inArray(fieldName, attribsInPkey) > -1; 
                            var isPartOfFKey = generator.isFieldPartOfFKey(schemaName,tableName, fieldName);
                            if (isPartOfPkey == true){
                                    %><li>               <%=fieldName%>:{ key : true , create: false, edit: false, list: false},</li><%
                            }else if (isPartOfFKey==false){
                                    %><li>               <%=fieldName%>:{ title: L["<%=fieldId%>"] ,  <%
                                    switch (fieldDataType){
                                        case "varchar" :
                                            %> width:"20%"<%
                                        break;
                                        case "integer" :
                                            %> width:"20%"<%
                                        break;
                                        case "double" :
                                            %> width:"20%"<%
                                        break;
                                        case "bool" :
                                            %> width:"12%",type: "radiobutton", options : {"true": L["true"] , "false": L["false"] },<%
                                        break;
                                        case "date" :
                                            %> width:"30%", type: "date", displayFormat: "yy-mm-dd"<%
                                        break;
                                        case "timestamp" :
                                            %> width:"30%", type: "date", displayFormat: "yy-mm-dd"<%
                                        break;
                                    }
                                    %>},</li><%
                            }else if (isPartOfFKey==true) {
                            
                                    var srcTable = generator.getFKeySrcTableByField(schemaName,tableName,fieldName);
                                    var isSrcTableLookupTable =generator.isLookupTable(srcTable.schema,srcTable.table);
                                    var srcTableName = srcTable.schema.toUpperCase()+"_"+srcTable.table.toUpperCase();
                                    var funcName2 = srcTable.table.toLowerCase();
                                    if (isSrcTableLookupTable == true) {
                                        %><li>              <%=fieldName%>:{ title: L["<%=fieldId%>"] ,width : "20%" , options: "index.php?a=<%=funcName2%>_options"  },</li><% 
                                    }else{
                                        var firstVarcharField = generator.getFirstVarcharField(srcTable.schema,srcTable.table);
                                        if (firstVarcharField==null) firstVarcharField = generator.getTableFieldNamesArr(srcTable.schema,srcTable.table,true)[0];
                                        %><li>              <%=fieldName%>:{title: L["<%=fieldId%>"], key: true,create: true, edit: true, list: true , options: "index.php?a=lookup&tableName=<%=srcTable.table%>&schemaName=<%=srcTable.schema%>&fieldName=<%=firstVarcharField%>&" },</li><% 
                                    }
                                    
                            }
                        } 
                        
                        var destTables = generator.getDestTableNames(schemaName,tableName);
                        for ( var j = 0; j < destTables.length; j++ ) { 
                                var destTableName = destTables[j].table.toUpperCase();
                                var destTable = destTables[j];
                                var attribsInPkey = generator.getPkeyFieldNames(destTables[j].schema,destTables[j].table);

                                var fkeysNames = generator.getFkeyNamesBetweenTables(destTable.schema,destTable.table,schemaName,tableName);
                                for (var f = 0 ; f< fkeysNames.length ; f++){
                                    var fKeyName= fkeysNames[f];
                                    var fkeyFieldNames = generator.getFKeyFieldNames(destTable.schema,destTable.table,fKeyName,false);
                
                                %>        <li>               <%=destTableName%>: { title: L["<%=destTableName%>"],width: "5%", sorting: false, edit: false, create: false, </li> 
                                        <li>                             display: function (tableData) {</li> 
                                        <li>                                  var $img = $(&quot;&lt;img src='/img/<%=destTableName%>.png<%="'"%> title="+L[&quot;<%=destTableName%>&quot;]+" /&gt;&quot;);</li>
                                        <li>                                  $img.click(function () {</li>
                                        <li>                                      $("#<%=funcName%>TableContainer").jtable("openChildTable",</li>
                                        <li>                                      $img.closest("tr"), //Parent row</li>
                                        <li>                                      {</li>
                                        <li>                                          title: L["List_T_<%=destTableName%>"],</li>
                                        <li>                                          actions: {</li>
                                        <li>                                              listAction: "index.php?a=<%=destTableName.toLowerCase()%>_list&keyName=<%=fkeyFieldNames[0]%>&<%=fkeyFieldNames[0]%>=" + tableData.record.<%=attribsInPkey[0]%>,</li>
                                        <li>                                              deleteAction: "index.php?a=<%=destTableName.toLowerCase()%>_delete",</li>
                                        <li>                                              updateAction: "index.php?a=<%=destTableName.toLowerCase()%>_update",</li>
                                        <li>                                              createAction: "index.php?a=<%=destTableName.toLowerCase()%>_create"</li>
                                        <li>                             },</li>
                                        <li>                             fields: {</li>
                                        <%
                                                var destTableAttrs = generator.getTableFieldNamesArr(destTables[j].schema,destTables[j].table,false);
                                                
                                                for (var z=0 ; z< destTableAttrs.length; z++){
                                                    var destFieldName = destTableAttrs[z];
                                                    var destFieldId = "f:"+destTable.table.toUpperCase()+"_"+destFieldName.toUpperCase() ;
                                                    var attribsInPkeyNested =  generator.getPkeyFieldNames(destTables[j].schema,destTables[j].table);
                                                    var isPartOfPkeyNested =  $.inArray(destFieldName, attribsInPkeyNested) > -1; 
                                                    var isFkInDestTable = generator.isAttribFKeyInDestTable(schemaName,tableName,destTable.schema, destTable.table, destFieldName);
                                                    var lookupUrl = "index.php?a=lookup&tableName="+destTable.table+"&schemaName="+destTable.schema+"&fieldName="+destFieldName+"&id=id";
                                                    /*generator.getJTableLookupUrlForField(destTable.schema,destTable.table,destFieldName);*/
                                                    var linkExists = generator.areFieldsLinked(destTable.schema,destTable.table,destFieldName,schemaName,tableName,attribsInPkey[0]);
                                                    if (isPartOfPkeyNested == true){
                                                        %><li>                                  <%=destFieldName%>: { key: true,  create: false,  edit: false,   list: false   },    </li> <%
                                                    }else if (isFkInDestTable == true) {
                                                        %><li>                                  <%=destFieldName%>: { type: "hidden", defaultValue: tableData.record.<%=destFieldName%>},</li><%
                                                    }else if(lookupUrl != null && linkExists===false){
                                                        %><li>                                  <%=destFieldName%>: { title: L["<%=destFieldId%>"]  , options: "<%=lookupUrl%>" },</li><%                                     
                                                    }else if(lookupUrl != null && linkExists===true){
                                                        %><li>                                  <%=destFieldName%>: { edit: false, list: false, create:false  },</li><%                                     
                                                    }else{
                                                        var destFieldDataType=generator.getFieldGenericDataType(destTable.schema,destTable.table,destFieldName); 
                                            %><li>               <%=destFieldName%>:{ title: L["<%=destFieldId%>"] ,  <%
                                                            switch (destFieldDataType){
                                                                case "varchar" :
                                                                    %> width:"20%"<%
                                                                break;
                                                                case "integer" :
                                                                    %> width:"20%"<%
                                                                break;
                                                                case "double" :
                                                                    %> width:"20%"<%
                                                                break;
                                                                case "bool" :
                                                                    %> width:"12%", type: "radiobutton", options : {"true": L["true"] , "false": L["false"] }<%
                                                                break;
                                                                case "date" :
                                                                    %> width:"30%", type: "date", displayFormat: "yy-mm-dd"<%
                                                                break;
                                                                case "timestamp" :
                                                                    %> width:"30%", type: "date", displayFormat: "yy-mm-dd"<%
                                                                break;
                                                            }
                                                            %>},</li><%                                    
                                                    
                                                    }
                                                }
                                        %>
                                        
                                        <li>                                  }                                  </li>
                                        <li>                              }, function (data) {                   </li>
                                        <li>                                  data.childTable.jtable("load");    </li>
                                        <li>                              });                                    </li>
                                        <li>                      });                                            </li>
                                        <li>                      return $img;                                   </li>
                                        <li>                                 }</li> 

                                        <li>              }, </li> <%
                                } 
                        
                        }
                    %>
                    
                    
                <li>           }    </li>       
                    
                
                        
                <li>       } </li>    
                <li>} </li>  
                <% } %>    
            </ol>
        </code>
        <code>
            <ol>
                <li> //&lt;!-- ---------------------------- template.php / profile -------------------&gt; </li>
                
            </ol>
        </code>
        <code>
            <ol>
                <li> //&lt;!-- ---------------------------- template.php / settings -------------------&gt; </li>
                <li> N/A</li>
                <%
                code=[];
                var schemaName = "public";
                var tableName = "users";
                var allAttribs=generator.getTableFieldNamesArr(schemaName,tableName,false); 
                for ( var j = 0; j < allAttribs.length; j++ ) {
                    var fieldName = allAttribs[j];
                     
                    if (["lock","lock_reason","last_login","created","admin"].includes(fieldName)) continue;
                    if (generator.getSourceFieldFromDestField("public","users","place_id") == null){
                        /*otkrij ako polje gleda u neku drugu tablicu*/
                        if (generator.isFieldTextual(schemaName,tableName,fieldName)){
                            if (fieldName == "pass" || fieldName == "password"){

                            } else{
                                code.push("");
                            }
                        }else if(generator.isFieldNumeric(schemaName,tableName,fieldName)){

                        }else if(generator.isFieldDateOrTime(schemaName,tableName,fieldName)){

                        }else{

                        }
                    } else {
                        
                    }

                    

                }
                for (var i = 0; i < code.length; i++) {
                    %><li><%= code[i] %></li><%
                }
                %>
            </ol>
        </code>
        <code lang="hljs javascript">
            <ol>
                <li> //&lt;!-- ---------------------------- en.js -------------------&gt; </li>
                <li>var L={</li>
                    <% 
                        for ( var i = 0; i < selectedTables.length; i++ ) {           
                           var schemaName=selectedTables[i].schema.toUpperCase();               
                           var tableName=selectedTables[i].table.toUpperCase();                             
                           var vars = new Array();  

                            vars.push(tableName+"_MENU") ; 
                            vars.push("Title_"+tableName);    
                            vars.push("List_T_"+tableName);   
                            vars.push(tableName+"_LIST_DESC"); 
                    
                           var allAttribs =generator.getTableFieldNamesArr(schemaName.toLowerCase(),tableName.toLowerCase(),false);   
                           for ( var j = 0; j < allAttribs.length; j++ ) {  
                                 var fieldName = allAttribs[j].toUpperCase();  
                                 var fieldId="f:"+tableName+"_"+fieldName ;
                                 vars.push(fieldId); 
                           }  
                           for ( var j = 0; j < vars.length; j++ ) {            
                              var  langVar = vars[j]; 
                              
                              var transl = genericHelper.capitalizeFirstAndDecapitalizeRest(langVar,"_");
                                 %> <li>      "<%=langVar%>":"<%=transl%>",</li><%
                           }  
                        } 
                      
                      %>
                    
                               
                    <li>}</li>
                               
            </ol>
        </code>
        <code>   
            <ol>
            <li> &lt;?php</li>
            <li> //&lt;!-- ---------------------------- actions.php -------------------&gt; </li>
            <li>$a=$_REQUEST[&#x27;a&#x27;];</li>
            <%
                code=[];
                var tableNames=[];
                for (var i = 0; i < selectedTables.length; i++) {
                    var schemaName=selectedTables[i].schema;
                    var tableName=selectedTables[i].table;
                    tableNames.push(tableName);
                }
                
                var tmp = genericHelper.glueArrayElements(tableNames, '&#x27;', '_list&#x27;');
                code.push( "$lists=array("+tmp.join(",")+");" );
                
                tmp = genericHelper.glueArrayElements(tableNames, '&#x27;', '_delete&#x27;');
                code.push( "$deletes=array("+tmp.join(",")+");" );
                
                tmp = genericHelper.glueArrayElements(tableNames, '&#x27;', '_switch&#x27;');
                code.push( "$switches=array("+tmp.join(",")+");" );
                
                tmp = genericHelper.glueArrayElements(tableNames, '&#x27;', '_search&#x27;');
                code.push( "$searches=array("+tmp.join(",")+");" );
                
                tmp = genericHelper.glueArrayElements(tableNames, '&#x27;', '_update&#x27;');
                code.push( "$updates=array("+tmp.join(",")+");" );
                
                tmp = genericHelper.glueArrayElements(tableNames, '&#x27;', '_insert&#x27;');
                code.push( "$inserts=array("+tmp.join(",")+");" );
                
                tmp = genericHelper.glueArrayElements(tableNames, '&#x27;', '_stat&#x27;');
                code.push( "$stats=array("+tmp.join(",")+");" );

                tmp = genericHelper.glueArrayElements(tableNames, '&#x27;', '_options&#x27;');
                code.push( "$options=array("+tmp.join(",")+");" );
                code.push("$custom=array();");
                code.push("$users=array(\"log_in\",\"register\");");
                for (var i = 0; i < code.length; i++) {
                    %> <li><%= code[i] %></li><%
                }
            %>
            <li>if ($svc-&gt;auth-&gt;isLoggedIn()){</li>
                <li>    if (in_array($a, $inserts)) {</li>
                <li>        require "actions/insert.php";</li>
                <li>    } </li>
                <li>    if (in_array($a, $updates)) {</li>
                <li>        require "actions/update.php";</li>
                <li>    }</li>
                <li>    if (in_array($a, $deletes)) {</li>
                <li>        require "actions/delete.php";</li>
                <li>    }</li>
                <li>    if (in_array($a, $switches)) {</li>
                <li>        require "actions/switches.php";</li>
                <li>    }</li>
                <li>    if (in_array($a, $lists)) {</li>
                <li>         require "actions/list.php";</li>
                <li>    }</li>
                <li>    if (in_array($a, $stats)) {</li>
                <li>         require "actions/stat.php";</li>
                <li>    }</li>
                <li>}</li>
                <li>if (in_array($a, $custom)) {</li>
                <li>    require "actions/custom.php";</li>
                <li>}</li>
                <li>if (in_array($a, $searches)) {</li>
                <li>    require "actions/search.php";</li>
                <li>}</li>
                <li>if (in_array($a, $options)) {</li>
                <li>    require "actions/options.php";</li>
                <li>}</li>
                <li>if (in_array($a, $users)) {</li>
                    <li>    require "actions/users.php";</li>
                <li>}</li>
     
            <li> ?&gt;</li>
            </ol>
    </code>

        <code>
            <ol>   
                <li> &lt;?php</li>
                <li> //&lt;!-- ---------------------------- update.php -------------------&gt; </li>
                <li>if (substr($a, -7) === "_update" && in_array($a,$updates)) {</li>
                <li>    $updateData=array();</li>
                <li>    $conditions=array();</li>                
                <li>    $allOk = true;</li>
                <li>    $damagedFields = array();</li>
                <li>    switch($a){</li>
                    <% 
                    for ( var i = 0; i < selectedTables.length; i++ ) { 
                       var schemaName=selectedTables[i].schema; 
                       var tableName=selectedTables[i].table; 
                       var funcName = generator.capitaliseFirstLetter(tableName); 
                       var attribsNonAutogenerated=generator.getTableFieldNamesArr(schemaName,tableName,true);  
                       var allAttribs = generator.getTableFieldNamesArr(schemaName,tableName,false);  
                       var phpArgs = genericHelper.joinArrayWithPRefixes(allAttribs, '$', ',');  
                      
                       var allAttribs=generator.getTableFieldNamesArr(schemaName,tableName,false);  
                       var listingFields = genericHelper.joinArrayWithPRefixes(allAttribs, '', '","');  
                       var listingFields = '"'+listingFields+'"';       
                       
                       var pKeyFields=generator.getPkeyFieldNames(schemaName,tableName);
                %>
                            <li>case "<%=tableName%>_update":</li>

                <%      
                        for ( var j = 0; j < allAttribs.length; j++ ) { 
                            var arrName=($.inArray(allAttribs[j],pKeyFields) == -1) ? '$updateData' : '$conditions';
                            var fieldName = allAttribs[j];   
                            var fieldDataType = generator.getFieldGenericDataType(schemaName,tableName,fieldName); 
                            var fieldData = generator.getFieldData(schemaName,tableName,fieldName);
                            if (fieldData.isNullable===false){
                %>
                            <li>    if (isset($_POST[&quot;<%=fieldName%>&quot;]) && $_POST[&quot;<%=fieldName%>&quot;]!=""){</li>
                            <li>         <%=arrName%>["<%=fieldName%>"] = $_POST[&quot;<%=fieldName%>&quot;];</li>
                <%                      var antiInjector = generator.genericDataType2PhpInject4autoins(fieldDataType,arrName+"['"+fieldName+"']"); %>
                            <li>         <%=arrName%>["<%=fieldName%>"] = <%=antiInjector%>;</li> 
                            <li>    } else {  $allOk = false; $damagedFields[]="<%=fieldName%>";}</li> 
                <%          } else { %>
                
                            <li>    <%=arrName%>["<%=fieldName%>"] = null;</li> 
                            <li>    if (isset($_POST[&quot;<%=fieldName%>&quot;]) && $_POST[&quot;<%=fieldName%>&quot;]!=""){</li>
                            <li>         <%=arrName%>["<%=fieldName%>"] = $_POST[&quot;<%=fieldName%>&quot;];</li>
                <%                      var antiInjector = generator.genericDataType2PhpInject4autoins(fieldDataType,arrName+"['"+fieldName+"']"); %>
                            <li>         <%=arrName%>["<%=fieldName%>"] = <%=antiInjector%>;</li> 
                            <li>    }  
                
                
                <%          } %>     
                <%      } %>     
                                    <li>    if ($allOk == true)</li>
                                    <li>        $data["Record"]=$svc->db->updateByArray("<%=schemaName%>.<%=tableName%>",$updateData,$conditions,array(<%=listingFields%>));</li>

                                <li>break;</li>
                <%  } %>   
                <li>    }</li> 
                <li>    $data["Result"]=($allOk == true)?"OK":"ERROR";</li>
                <li>    if ($allOk == false){ $data["Message"]="Check your input data for fields: ".join(",",$damagedFields); }</li>
                <li>    if ($data["Record"] == null || $data["Record"] == array()) { $data["Result"]="ERROR";}</li>
                <li>    echo json_encode($data);</li>
                <li>}</li>
            </ol>
        </code>
        <code>
            <ol>   
                <li> &lt;?php</li>
                <li> //&lt;!-- ---------------------------- insert.php -------------------&gt; </li>
                <li>if (substr($a, -7) === "_insert" && in_array($a,$inserts)) {</li>
                <li>    $allOk = true;</li>
                <li>    $damagedFields = array();</li>                
                <li>    $inputData=array();</li>
                <li>switch ($a) {</li>
    
<% 
    for ( var i = 0; i < selectedTables.length; i++ ) { 
       var schemaName=selectedTables[i].schema; 
       var tableName=selectedTables[i].table; 
       var funcName = generator.getFunctionName(schemaName,tableName,false); 
       var attribsNonAutogenerated=generator.getTableFieldNamesArr(schemaName,tableName,true);  
       
       var allAttribs=generator.getTableFieldNamesArr(schemaName,tableName,false);  
       var listingFields = genericHelper.joinArrayWithPRefixes(allAttribs, '', '","');  
       var listingFields = '"'+listingFields+'"';
%>
                <li>case "<%=tableName%>_insert":</li
<%      
        for ( var j = 0; j < attribsNonAutogenerated.length; j++ ) { 
            var fieldName = attribsNonAutogenerated[j];   
            var fieldDataType = generator.getFieldGenericDataType(schemaName,tableName,fieldName); 
            var fieldData = generator.getFieldData(schemaName,tableName,fieldName);
            if (fieldData.isNullable===false){
%>
            <li>    if (isset($_POST[&quot;<%=fieldName%>&quot;]) && $_POST[&quot;<%=fieldName%>&quot;]!=""){</li>
            <li>         $inputData["<%=fieldName%>"] = $_POST[&quot;<%=fieldName%>&quot;];</li>
<%                      var antiInjector = generator.genericDataType2PhpInject4autoins(fieldDataType,"$inputData['"+fieldName+"']"); %>
            <li>         $inputData["<%=fieldName%>"] = <%=antiInjector%>;</li> 
            <li>    }else{</li> 
            <li>        $allOk = false;</li> 
            <li>        $damagedFields[]="<%=fieldName%>"; </li>             
            <li>    }</li> 
<%          } else { %>
            <li>    $inputData["<%=fieldName%>"] = null;</li> 
            <li>    if (isset($_POST[&quot;<%=fieldName%>&quot;]) && $_POST[&quot;<%=fieldName%>&quot;]!=""){</li>
            <li>         $inputData["<%=fieldName%>"] = $_POST[&quot;<%=fieldName%>&quot;];</li>
<%                      var antiInjector = generator.genericDataType2PhpInject4autoins(fieldDataType,"$inputData['"+fieldName+"']"); %>
            <li>         $inputData["<%=fieldName%>"] = <%=antiInjector%>;</li> 
            <li>    }  </li>
 

<%          } %>     
<%      } %>     
                    <li>    if ($allOk == true){</li>
                    <li>        $data["Record"]=$svc->db->insertByArray("<%=schemaName%>.<%=tableName%>",$inputData,array(<%=listingFields%>));</li>
                    <li>    }
                <li>    break;</li>
<%  } %>            
                <li>    }</li>
                <li>    $data["Result"]=($allOk == true)?"OK":"ERROR";</li>
                <li>    if ($allOk == false){ $data["Message"]="Check your input data for fields: ".join(",",$damagedFields); }</li>
                <li>    if ($data["Record"] == null || $data["Record"] == array()) { $data["Result"]="ERROR";}</li>
                <li>    echo json_encode($data);</li>
                <li>}</li>
            </ol>
        </code>    

        <code>   
            <ol>
            <li> &lt;?php</li>
            <li> //&lt;!-- ---------------------------- list.php -------------------&gt; </li>
            <li>if (substr($a, -5) === "_list" && in_array($a,$lists)) {</li>
            <li>    $data["Result"]="OK";</li>
            <li>    switch ($a){</li>
                    <% 
                    for ( var i = 0; i < selectedTables.length; i++ ) {           
                         var schemaName=selectedTables[i].schema;              
                         var tableName=selectedTables[i].table;    
                         var tableHasUserField =generator.getUserFieldNamesFromTable(schemaName,tableName).length>0 ? true :false ;
                         var tbl=schemaName+"."+tableName;       
                    %>
                                    <li>        case "<%=tableName%>_list":</li>
                                        <li>            $data["Records"]=$svc->listTable(\"<%=tbl%>\",$svc->getOrder(),<%=tableHasUserField%>);</li>
 
                                    <li>        break;</li>
                    <% } %>        
                    <li>    }</li>
                    <li>    $data["TotalRecordCount"]= $data["Records"][0]["TotalRecordCount"];</li>
                    <li>    for ($i=0; $i < count($data["Records"]) ; $i++){</li>
                    <li>         unset($data["Records"][$i]["TotalRecordCount"]);</li>
                    <li>    }</li>
                    <li>    echo json_encode($data);</li>

           <li>}</li>
            </ol>
        </code>
        <code>   
            <ol>
            <li> &lt;?php</li>
            <li> //&lt;!-- ---------------------------- index.php -------------------&gt; </li>
            <li>  
                TODO ovo napravit do kraja tako da pejstan fajl kad san siguran da je gotovo
            </li>
            </ol>
        </code>
        <code>   
            <ol>
            <li> &lt;?php</li>
            <li> //&lt;!-- ---------------------------- actions/delete.php -------------------&gt; </li>
            <li>    if (substr($a, -7) === \"_delete\"  && in_array($a,$deletes))  { </li>
            <li>    $allOk = true;</li>
            <li>    switch($a){</li>
            <%
                
                for ( var i = 0; i < selectedTables.length; i++ ) { 
                   var schemaName=selectedTables[i].schema; 
                   var tableName=selectedTables[i].table; 
                   var funcName = generator.getFunctionName(schemaName,tableName,false); 
                   var attribsInPkey=generator.getPkeyFieldNames(schemaName,tableName);   
                   var phpArgsPkey = genericHelper.joinArrayWithPRefixes(attribsInPkey, '$', ',');  
                   var pkeyName = genericHelper.joinArrayWithPRefixes(attribsInPkey, '', ',');  
                   var tableHasUserField =generator.getUserFieldNamesFromTable(schemaName,tableName).length;
            %>
                            <li>case "<%=tableName%>_delete":</li>
                            
            
            <%      for ( var j = 0; j < attribsInPkey.length; j++ ) { 
                        var fieldName = attribsInPkey[j];   
                        var fieldDataType = generator.getFieldGenericDataType(schemaName,tableName,fieldName); %>
                        <li>    if (isset($_POST[&quot;<%=fieldName%>&quot;])){</li>
                        <li>         $<%=fieldName%> = $_POST[&quot;<%=fieldName%>&quot;];</li>
            <%                      var antiInjector = generator.genericDataType2PhpInject(fieldDataType,fieldName); %>
                        <li>         $<%=fieldName%> = <%=antiInjector%>;</li> 
                        <li>    }else{</li> 
                        <li>        $allOk = false;</li> 
                        <li>    }</li> 
            <%      } %>     
                                <li>    if ($allOk == true){</li>
                                <li>        $data["Result"]="OK";</li>
                                <li>        $svc->deleteById("<%=tableName%>","<%=pkeyName%>",<%=phpArgsPkey%>,<%=tableHasUserField%>);</li>
                                <li>    }</li> 
                            <li>break;</li>
            <%  } %> 
            <li>    }</li>
            <li>if ($allOk == false) $data=SqlClass::getErrorMessage();</li>
            <li>    echo json_encode($data);</li>

            <li>}</li>
    
            <li>?&gt;</li>
            </ol>
    </code>
        <code>   
            <ol>
            <li>&lt;?php</li>
            <li> //&lt;!-- ---------------------------- options.php (large tables)-------------------&gt; </li>
            <%
                code=[];
                code.push("if (in_array($a,$options) && substr($a, -8) === \"_options\"){");
                code.push("$res[\"Result\"]=\"OK\";");
                code.push(" switch ($a){");
                
                for (var i = 0; i < selectedTables.length; i++) {
                    var schemaName=selectedTables[i].schema;
                    var tableName=selectedTables[i].table;
                    if (generator.isLookupTable(schemaName,tableName)) continue;
                    var field = generator.getFirstVarcharField(schemaName,tableName);
                    if (field == null) continue;
                    var pkeyField = generator.getPkeyFieldNames(schemaName,tableName);
                    code.push("     case  \""+tableName+"_options\":");
                    var isUserTable=generator.getUserFieldNamesFromTable(schemaName,tableName).length>0;
                    if (isUserTable){
                        tmp = "         $res[\"Options\"]=$svc->getJTableLookupOptionsWithUser(\""+schemaName+"\",\""+tableName+"\",\""+field+"\",\""+pkeyField+"\",\"user_id={$svc->getUserId()}\");";
                    } else {
                        tmp = "         $res[\"Options\"]=$svc->getJTableLookupOptions(\""+schemaName+"\",\""+tableName+"\",\""+field+"\",\""+pkeyField+"\");";
                    }
                    tmp = genericHelper.toHtmlEntities(tmp);
                    code.push(tmp);
                    
                    
                    code.push("     break;");
                }
                
                code.push(" }");
                code.push("     die(json_encode($res));");
                code.push("}");
                for (var i = 0; i < code.length; i++) {
                    %> <li><%= code[i] %></li><%
                }
            %>
    
            <li> ?&gt;</li>
            </ol>
    </code>

        <code>   
            <ol>
            <li>&lt;?php</li>
            <li> //&lt;!-- ---------------------------- options.php -------------------&gt; </li>
            <%
                code=[];
                code.push("if (in_array($a,$options) && substr($a, -8) === \"_options\"){");
                code.push("$res[\"Result\"]=\"OK\";");
                code.push(" switch ($a){");
                
                for (var i = 0; i < selectedTables.length; i++) {
                    var schemaName=selectedTables[i].schema;
                    var tableName=selectedTables[i].table;
                    if (!generator.isLookupTable(schemaName,tableName)) continue;
                    var field = generator.getFirstVarcharField(schemaName,tableName);
                    if (field == null) continue;
                    var pkeyField = generator.getPkeyFieldNames(schemaName,tableName);
                    code.push("     case  \""+tableName+"_options\":");
                    var isUserTable=generator.getUserFieldNamesFromTable(schemaName,tableName).length>0;
                    if (isUserTable){
                        tmp = "         $res[\"Options\"]=$svc->getJTableLookupOptionsWithUser(\""+schemaName+"\",\""+tableName+"\",\""+field+"\",\""+pkeyField+"\",\"user_id={$svc->getUserId()}\");";
                    } else {
                        tmp = "         $res[\"Options\"]=$svc->getJTableLookupOptions(\""+schemaName+"\",\""+tableName+"\",\""+field+"\",\""+pkeyField+"\");";
                    }
                    tmp = genericHelper.toHtmlEntities(tmp);
                    code.push(tmp);
                    
                    
                    code.push("     break;");
                }
                
                code.push(" }");
                code.push("     die(json_encode($res));");
                code.push("}");
                for (var i = 0; i < code.length; i++) {
                    %> <li><%= code[i] %></li><%
                }
            %>
    
            <li> ?&gt;</li>
            </ol>
    </code>
        <code>   
            <ol>
            <li> &lt;?php</li>
            <li> //&lt;!-- ---------------------------- var.php -------------------&gt; </li>
    
            <li>class Vars{</li>
                <li>     public static $login="postgres";         </li>
                <li>     public static $pass="sragne";         </li>
                <li>     public static $server="127.0.0.1";        </li> 
                <li>     public static $dbName="apoidia";         </li>
                <li>     public static $tbPrefix="";         </li>
                <li>     public static $port="5432";     </li>
                <li>     public static $schema="public";     </li>
                <li>}</li>
            <li>?&gt;</li>
            </ol>
    </code>


</pre>
</script>
