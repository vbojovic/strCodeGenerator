<script type="text/html" id="user_tmpl">
      <pre>
       <code>
            <ol>   
<% 
    for ( var i = 0; i < selectedTables.length; i++ ) { 
       var schemaName=selectedTables[i].schema; 
       var tableName=selectedTables[i].table; 
       var funcName = generator.getFunctionName(schemaName,tableName,false); 
       var attribsNonAutogenerated=generator.getTableFieldNamesArr(schemaName,tableName,true);  
       var allAttribs = generator.getTableFieldNamesArr(schemaName,tableName,false);  
       var phpArgs = genericHelper.joinArrayWithPRefixes(allAttribs, '$', ',');  
      
       var allAttribs=generator.getTableFieldNamesArr(schemaName,tableName,false);  
       var listingFields = genericHelper.joinArrayWithPRefixes(allAttribs, '', '","');  
       var listingFields = '"'+listingFields+'"';       
       
       var pKeyFields=generator.getPkeyFieldNames(schemaName,tableName);
%>
            <li>case "<%=schemaName%>_<%=tableName%>_update_jTable":</li>
                <li>    $updateData=array();</li>
                <li>    $conditions=array();</li>                
                <li>    $allOk = true;</li>
                <li>    $damagedFields = array();</li>
<%      
        for ( var j = 0; j < allAttribs.length; j++ ) { 
            var arrName=($.inArray(allAttribs[j],pKeyFields) == -1) ? '$updateData' : '$conditions';
            var fieldName = allAttribs[j];   
            var fieldDataType = generator.getFieldGenericDataType(schemaName,tableName,fieldName); 
            var fieldData = generator.getFieldData(schemaName,tableName,fieldName);
            if (fieldData.isNullable===false){
%>
            <li>    if (isset($_POST[&quot;<%=fieldName%>&quot;]) && $_POST[&quot;<%=fieldName%>&quot;]!=""){</li>
            <li>         <%=arrName%>["<%=fieldName%>"] = $_POST[&quot;<%=fieldName%>&quot;];</li>
<%                      var antiInjector = generator.genericDataType2PhpInject4autoins(fieldDataType,arrName+"['"+fieldName+"']"); %>
            <li>         <%=arrName%>["<%=fieldName%>"] = <%=antiInjector%>;</li> 
            <li>    } else {  $allOk = false; $damagedFields[]="<%=fieldName%>";}</li> 
<%          } else { %>

            <li>    <%=arrName%>["<%=fieldName%>"] = null;</li> 
            <li>    if (isset($_POST[&quot;<%=fieldName%>&quot;]) && $_POST[&quot;<%=fieldName%>&quot;]!=""){</li>
            <li>         <%=arrName%>["<%=fieldName%>"] = $_POST[&quot;<%=fieldName%>&quot;];</li>
<%                      var antiInjector = generator.genericDataType2PhpInject4autoins(fieldDataType,arrName+"['"+fieldName+"']"); %>
            <li>         <%=arrName%>["<%=fieldName%>"] = <%=antiInjector%>;</li> 
            <li>    }  


<%          } %>     
<%      } %>     
                    <li>    if ($allOk == true){</li>
                    <li>        $data["Result"]="OK";</li>
                    <li>        $data["Record"]=$this->db->updateByArray("<%=schemaName%>.<%=tableName%>",$updateData,$conditions,array(<%=listingFields%>));</li>
                    <li>        if ($data["Record"] == null || $data["Record"] == array()) { $data["Result"]="ERROR";}</li>
                    <li>    }else{</li>
                    <li>        $data["Result"]="ERROR";</li> 
                    <li>        $data["Message"]="Check your input data for fields: "+join(",",$damagedFields);</li> 
                    <li>    }</li> 
                    <li>    echo json_encode($data);</li>
                <li>break;</li>
<%  } %>                 
            </ol>
        </code>    
      </pre> 
</script>

